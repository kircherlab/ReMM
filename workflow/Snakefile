from os.path import join
from glob import glob
import datetime
import pandas as pd


##### check snakemake min version #####

from snakemake.utils import min_version

min_version("6.0.5")


##### load config and sample sheets #####


configfile: "config/config.yaml"
configfile: "config/featuresConfig38.json"


# TODO implement validation
# validate(config, schema="../schemas/config.schema.yaml")

##### all rules #####


##### include files #####


include: "rules/features.smk"


rule all_feature_sets:
    input:
        vcf=expand(
            "results/features/feature_sets/{feature_set}.vcf.gz",
            feature_set=list(config["feature_sets"].keys()),
        ),
        idx=expand(
            "results/features/feature_sets/{feature_set}.vcf.gz.tbi",
            feature_set=list(config["feature_sets"].keys()),
        ),


include: "rules/variants.smk"


def getAllVariantsInput():
    output = []
    for variant_set in config["variants"]:
        output += getVariantsInput(variant_set, "annotate")
    return output


rule all_variants:
    input:
        getAllVariantsInput(),


include: "rules/annotate.smk"
include: "rules/process/getUtils.smk"
include: "rules/process/folds.smk"
include: "rules/process/createModelData.smk"
include: "rules/model/parSMURF.smk"


# depricated worklows
# include: "rules/process/negativeVariants.smk"
